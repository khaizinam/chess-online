<html>

<head>
    {{> head}}
</head>

<body>
    <div id="liveAlertPlaceholder"></div>
    <div>
        <div class="bg-black text-white text-center justify-center rounded-4xl py-30">
            <h2 class="text-4xl font-bold">Game code</h2>
            <div class="flex flex-col gap-4 px-4 items-center justify-center m-5">
                <!-- <input class="bg-white rounded-xl text-black py-2 px-3 md:w-2/8 w-3/4" type="text" id="codeInput" /> -->

                <div class="md:w-2/8 w-3/4">
                    <label for="codeInput" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Random
                        Code</label>
                    <div class="relative">
                        <input type="text" id="codeInput"
                            class="block w-full p-4 text-sm text-gray-900 rounded-2xl bg-gray-50"
                            placeholder="Enter code..." required />
                        <button id="rndCode"
                            class="text-white absolute end-2.5 bottom-2.5 focus:ring-4 font-medium rounded-lg text-sm px-4 py-2 bg-gray-800 rounded-2xl active:scale-95 transition-all duration-150 hidden md:block">
                            Random Code
                        </button>
                    </div>
                </div>
                <div>
                    <button class="bg-gray-800 py-3 px-5 rounded-2xl active:scale-95 transition-all duration-150"
                        id="createGame">
                        Create game
                    </button>
                    <button class="bg-gray-800 py-3 px-5 rounded-2xl active:scale-95 transition-all duration-150"
                        id="joinGame">
                        Join game
                    </button>
                </div>
            </div>

            <div style="color: red" id="errorMessage"></div>
        </div>
    </div>
    <script>
        const codeinput = document.querySelector('#codeInput');
        const creategame = document.querySelector('#createGame');
        const joingame = document.querySelector('#joinGame');
        const genRndCode = document.querySelector('#rndCode');
        let currentAlertMove = 2;
        let amountOfAlerts = 0;
        const alertPlaceholder = document.getElementById(
            'liveAlertPlaceholder'
        );
        function getRandomWholeNumber(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        const appendAlert = (title, message, type) => {
            const wrapper = document.createElement('div');
            if (amountOfAlerts >= 3) {
                amountOfAlerts = 0;
                alertPlaceholder.innerHTML = '';
                currentAlertMove = 2;
            }
            wrapper.innerHTML = [
                `<div class="bg-yellow-200 p-3 rounded-xl fixed bottom-${currentAlertMove} inset-x-0 mx-auto w-1/3 transition-all duration-200 ease-in-out" role="alert">`,
                `<strong>${title}</strong> <div>${message}</div>`,
                ' <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>',
            ].join('');

            currentAlertMove += 20;
            amountOfAlerts += 1;

            alertPlaceholder.append(wrapper);
        };
        creategame.addEventListener('click', () => {
            if (
                codeinput.value.trim() === '' ||
                codeinput.value.length < 10
            ) {
                appendAlert(
                    'Warning!',
                    'You have inserted in an invalid code. Please make it at least 10 characters long',
                    'warning'
                );
            } else {
                window.location.replace('/white?code=' + codeinput.value);
            }
        });
        joingame.addEventListener('click', () => {
            if (
                codeinput.value.trim() === '' ||
                codeinput.value.length < 10
            ) {
                appendAlert(
                    'Warning!',
                    'You have inserted in an invalid code. Please make it at least 10 characters long',
                    'warning'
                );
            } else {
                window.location.replace('/black?code=' + codeinput.value);
            }
        });
        genRndCode.addEventListener('click', () => {
            let rndNum = getRandomWholeNumber(
                10000000000,
                999999999999
            );
            codeinput.value = rndNum;

            navigator.clipboard.writeText(rndNum);
        });
        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('error') == 'invalidCode') {
            $('#errorMessage').text('Invalid invite code');
        } else if (urlParams.get('error') == 'limitReached') {
            $('#errorMessage').text('Server is full (Max 20 rooms). Please try again later.');
        } else if (urlParams.get('error') == 'roleTaken') {
            $('#errorMessage').text('This role is already taken in this room. Please join as another color or a different room.');
        }
    </script>
</body>

</html>